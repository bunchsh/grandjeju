<!--
 @filename    : inquiry_write.html
 @author      : 한송희 (onee.ssong@gmail.com)
 @description : Grandjeju 1:1 문의 작성 페이지의 구조 구현
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrandJeju - 1:1 문의 작성</title>

    <link rel="stylesheet" href="../assets/css/all.css">
    <link rel="stylesheet" href="../assets/css/header_style.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/style_inquiry.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&family=Rubik&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
</head>

<body>
    <div id="wrap">
        <!-- HEADER -->
        <div id="header">
            <h2 class="title">1:1 문의 작성</h2>
        </div>

        <!-- CONTAINER -->
        <div id="container">
            <!-- CONTENT -->
            <div id="content">
                <form id="inquiry_write">
                    <!-- 문의 종류 선택 -->
                    <div class="select_group">
                        <select class="inquiry_option" id="option">
                            <option value="">문의 종류</option>
                            <option value="예약 문의">예약 문의</option>
                            <option value="시설 문의">시설 문의</option>
                            <option value="취소 및 환불">취소 및 환불</option>
                            <option value="기타 문의">기타 문의</option>
                        </select>
                    </div>
                    <!-- 제목 항목 -->
                    <div class="title_group">
                        <input class="title_input" id="title" type="text" placeholder="제목">
                    </div>
                    <!-- 본문 항목 -->
                    <div class="editor_group">
                        <div id="editor"></div>
                    </div>
                    <!-- 버튼 -->
                    <div class="btn_group">
                        <button type="submit" class="btn_write">등록</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script src='https://unpkg.com/sweetalert/dist/sweetalert.min.js'></script>
    <script src="./assets/js/write_regex_helper.js"></script>
    <script>
        /** editor 구성 */
        const Editor = toastui.Editor;
        const editor = new Editor({
            el: document.querySelector('#editor'),
            height: '500px',
            initialEditType: 'html',
            previewStyle: 'vertical'
        });
    </script>
    <script>
        let json = null;
        (async () => {
            try {
                const response = await axios.get('/members/info');
                json = response.data
            } catch (e) {
                alert(e.response.data.rtmsg);
                // history.back();
                return;
            }
            console.log(json.item);
        })();
        
        document.querySelector('#inquiry_write').addEventListener('submit', async(e) => {
            e.preventDefault();
            
            const regexHelper = new RegexHelper();

            /** 문의 종류 검사 */
            if (!regexHelper.value(".inquiry_option", "문의 종류가 선택되지 않았습니다.")) {return false;}
            /** 제목 검사 */
            if (!regexHelper.value(".title_input", "제목을 입력되지 않았습니다.")) {return false;}
            /** 내용 검사 */
            if (!regexHelper.editor_value(editor.getHTML(), "내용이 입력되지 않았습니다.")) {return false;}

            
            console.log(json.item);
        
            const user_id = json.item.user_id;
            const user_name = json.item.user_name;
            const type = document.querySelector('#option').value;
            const title = document.querySelector("#title").value;
            const inquiry_text = editor.getHTML();

            let json2 = null;

            try {
                const response = await axios.post("/inquiry", {
                    user_id : user_id,
                    user_name : user_name,
                    type : type,
                    title : title,
                    inquiry_text : inquiry_text
                })
                json2 = response.data
                } catch (e) {
                    alert(e.response.data.rtmsg);
                    return;
                }
                console.log(json2);
                if (json2 != null) {
                    window.location ="/GJ9_inquiry_detail_page/inquiry_detail_before.html?inquiry_id=" + json2.item[0].inquiry_id;
                }
        })

    </script>
</body>

</html>