<!--
 @filename    : my.html
 @author      : 양수원 (ysw7939@gmail.com)
 @description : Grandjeju 마이 페이지의 구조 구현
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrandJeju - MY PAGE</title>

    <link rel="stylesheet" href="../assets/css/side_menu.css" />
    <link rel="stylesheet" href="../assets/css/all.css">
    <link rel="stylesheet" href="../assets/css/header_style.css">
    <link rel="stylesheet" href="assets/css/my_style.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&family=Rubik&display=swap" rel="stylesheet">

</head>

<body>
    <div id="wrap">
        <!-- HEADER -->
        <div id="header">
            <warp class="header_warp">
                <div class="hamburger_icon">
                    <a><img src="assets/img/Hamburger_icon.png"></a>
                </div>
                <h2 class="title">MY PAGE</h2>
            </warp>
        </div>
        <div id="content">
        </div>
        <div id="reserv" class="tab_content">
            
        </div>
        <div id="inquiry" class="tab_content none">
            <div class="history">
                <a href="../GJ9_inquiry_detail_page/inquiry_detail_after.html">
                    <img src="assets/img/right-arrow.png">
                    <h3 class="title_inquiry"></h3>
                    <span class="state_inquiry"></span>
                    <span class="inquiry_date"></span>
                </a>
            </div>
            <div class="history">
                <a class="pluse" href="../GJ8_inquiry_write_page/inquiry_write.html">
                    <img src="assets/img/plus.png">
                </a>
            </div>
        </div>
        <div id="review" class="tab_content none">
            <div class="history">
                <a href="../GJ19_review_datail_page/review_detail_writer.html">
                    <img src="assets/img/right-arrow.png">
                    <h3 class="title_review"></h3>
                    <span class="review_date"></span>
                </a>
            </div>
        </div>
        <!-- 사이드 메뉴바 -->
        <div data-include="../assets/inc/side_menu.html"></div>
    </div>


    <script type="text/javascript" src="assets/js/tab.js"></script>

    <script src="../assets/js/side_menu_login.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script async="false" src="../assets/js/include_side.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>

    <script id="content-template" type="text/x-handlebars-template">
        <div class="user_wrap">
            <a class="setting" href="../GJ5_my_modify/my_modify.html"><img src="assets/img/setting_button.png"></a>
            <a class="user_img"><img src="assets/img/user.png"></a>
            <h3><span class="user_name">{{user_name}}</span> 님</h3>
        </div>
        <div id="tabs">
            <div class="tab_three" data-tab='reserve'>
                <a class="default"><span>예약내역</span></a>
            </div>
            <div class="tab_three" data-tab='inquiry'>
                <a><span>1:1문의</span></a>
            </div>
            <div class="tab_three" data-tab='review'>
                <a><span>리뷰내역</span></a>
            </div>
        </div>
    </script>

    <script id="reserv-template" type="text/x-handlebars-template">
        {{#each item}}
            <div class="history">
                <a href="../GJ7_reservation_detail_page/reservation_detail.html">
                    <img src="assets/img/right-arrow.png">
                    <h3 class="room">{{room}}</h3>
                    <span class="reserv_name">{{reserv_name}}</span>
                    <div class="stay_date"><span class="stay_start">{{stay_start}}</span> ~ <span class="stay_end">{{stay_end}}</span></div>
                </a>
            </div>
        {{/each}}
        <!-- <div class="history">
            <a href="../GJ7_reservation_detail_page/reservation_detail.html">
                <img src="assets/img/right-arrow.png">
                <h3 class="room">{{room}}</h3>
                <span class="reserv_name">{{reserv_name}}</span>
                <div class="stay_date"><span class="stay_start">{{stay_start}}</span> ~ <span class="stay_end">{{stay_end}}</span></div>
            </a>
        </div> -->
    </script>

    <script>
        (async () => {
            let json = null;

            try {
                const response = await axios.get('/memberstest/info');
                json = response.data;
            } catch (e) {
                alert(e.response.data.rtmsg);
                history.back();
                return;
            }

            if (json != null) {
                // console.log(json.item);
                const profile = document.querySelector("#content-template").innerHTML;
                const p_template = Handlebars.compile(profile);
                const p_html = p_template(json.item);

                document.querySelector('#content').insertAdjacentHTML('beforeend', p_html);

                (async () => {

                    if (!json.item.user_id) {
                        alert('예약 내역이 없습니다.');
                        return;
                    }

                    let json2 = null;

                    try {
                        const response = await axios.get('/reservationtest/' + json.item.user_id);
                        json2 = response.data;
                    } catch (e) {
                        alert(e.response.data.rtmsg);
                        return;
                    }

                    if(json2 != null) {
                        console.log(json2);
                        const reserv = document.querySelector("#reserv-template").innerHTML;
                        const r_template = Handlebars.compile(reserv);
                        const r_html = r_template(json2);
                        document.querySelector('#reserv').insertAdjacentHTML('beforeend', r_html);
                    }
                })();
            };
        })();
    </script>

</body>

</html>