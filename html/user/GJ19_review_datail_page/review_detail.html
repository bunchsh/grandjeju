<!--
 @filename    : review_detail.html
 @author      : 한송희 (onee.ssong@gmail.com)
 @description : Grandjeju 리뷰 상세 페이지의 구조 구현
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrandJeju - 문의 내역</title>

    <link rel="stylesheet" href="../assets/css/all.css">
    <link rel="stylesheet" href="../assets/css/header_style.css">
    <link rel="stylesheet" href="../assets/css/side_menu.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/style_review_detail.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&family=Rubik&display=swap" rel="stylesheet">    
</head>

<body>
    <div id="wrap">
        <!-- HEADER -->
        <div id="header">
            <warp class="header_warp">
                <div class="hamburger_icon">
                    <a><img src="../assets/img/Hamburger_icon.png"></a>
                </div>
                <h2 class="title">REVIEW</h2>
            </warp>
        </div>
        <!-- CONTAINER -->
        <div id="container">
            <!-- CONTENT -->
            <div id="content">
                <!-- 제목 항목 -->
                <div class="title_group">
                    <span class="review_title"></span>
                </div>
                <!-- 작성자 및 작성 날짜 항목 -->
                <div class="writer_group">
                    <span class="user_name"></span>
                    <span class="review_date"></span>
                </div>
                <!-- 본문 항목 -->
                <div class="main_group">
                    <div class="text">

                    </div>
                </div>

                <!-- 버튼 -->
                <div class="btn_group">
                </div>
            </div>
        </div>
    <!-- 사이드 메뉴바 -->
    <div data-include="../assets/inc/side_menu.html"></div>
</div>

    <script async="false" src="../assets/js/include_side.js"></script>
    <script src="../assets/js/side_menu_login.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src='https://unpkg.com/sweetalert/dist/sweetalert.min.js'></script>

    <script>
        // GET 파라미터 받기
        const params = new URLSearchParams(window.location.search);
        let review_id = params.get('review_id');

        (async () => {
            

            const title = document.querySelector(".review_title")
            const text = document.querySelector(".text")
            const btn_group = document.querySelector(".btn_group")

            let json_review = null;
            let json_login = null;
            try {
                const response1 = await axios.get('/review/' + review_id)
                const response2 = await axios.get('/members/info');
                json_review = response1.data
                json_login = response2.data
            }catch (e) {
                swal({
                text: e.response.data.rtmsg, // Alert 내용
                buttons: {
                    OK: true,  // 확인 버튼
                    }
                }).then((value) => {   // 확인 버튼 이벤트
                    if (value == 'OK') {
                    return;
                    }
                });
            }
            if(json_review != null) {
                console.log(json_review);
                title.innerHTML = json_review.item[0].title;
                text.innerHTML = json_review.item[0].text
            }

            if (json_review.item[0].user_id == json_login.item.user_id) {
                btn_group.innerHTML = ('afterbegin',
                    `
                    <button class="btn_modify" type="button"><a href="/GJ20_review_modify_page/review_modify.html?review_id=${review_id}">수정</a></button>
                    <button class="btn_delete" type="button">삭제</button>
                    `
                )
                document.querySelector('.btn_delete').addEventListener('click', e => {
                    swal({
                        text: "정말 삭제하시겠습니까?", // Alert 내용
                        buttons: {
                            OK : true,  // 확인 버튼
                            cancel: "cancel"    // 취소 버튼
                        }
                    }).then( async (value) => {   // 확인 버튼 이벤트
                        console.log(value);
                        if(value == 'OK'){
                            try {
                                const url = '/review/' + review_id;
                                await axios.delete(url);
                            } catch (e) {
                                // 에러가 발생한 경우 벡엔드가 주는 json 받기
                                alert(e);
                                return;
                            }
                            window.location ="/GJ4_my_page/my.html"
                        }
                        
                    });
                })
            }
        })();
    </script>
</body>
</html>