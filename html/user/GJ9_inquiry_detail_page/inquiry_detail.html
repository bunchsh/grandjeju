<!--
 @filename    : inquiry_detail.html
 @author      : 한송희 (onee.ssong@gmail.com)
 @description : Grandjeju 1:1 문의 상세 페이지(답변 전)의 구조 구현
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrandJeju - 문의 내역</title>

    <link rel="stylesheet" href="../assets/css/all.css">
    <link rel="stylesheet" href="../assets/css/header_style.css">
    <link rel="stylesheet" href="../assets/css/side_menu.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/style_inquiry_detail.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&family=Rubik&display=swap" rel="stylesheet">
</head>

<body>
    <div id="wrap">
        <!-- HEADER -->
        <div id="header">
            <warp class="header_warp">
                <div class="hamburger_icon">
                    <a><img src="../assets/img/Hamburger_icon.png"></a>
                </div>
                <h2 class="title">1:1 문의</h2>
            </warp>
        </div>
        <!-- CONTAINER -->
        <div id="container">
            <!-- CONTENT -->
            <div id="content">
                <!-- 제목 항목 -->
                <div class="title_group">
                    <span class="type"></span>
                    <span class="title_title"></span>
                </div>
                <!-- 작성자 및 작성 날짜 항목 -->
                <div class="writer_group">
                    <span class="user_name"></span>
                    <span class="inquiry_date"></span>
                </div>
                <!-- 본문 항목 -->
                <div class="main_group">
                    <div class="ask_group">
                        <p class="inquiry_text">
                    </div>
                    <div class="answer_group">
                        <p class="answer_text">
                    </div>
                </div>

                <!-- 버튼 -->
                <div class="btn_group">
                    <button class="btn_delete" type="button">삭제</button>
                </div>
            </div>
        </div>
    <!-- 사이드 메뉴바 -->
    <div data-include="../assets/inc/side_menu.html"></div>
</div>

<script async="false" src="../assets/js/include_side.js"></script>
<script src="../assets/js/side_menu_login.js"></script>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src='https://unpkg.com/sweetalert/dist/sweetalert.min.js'></script>

<script>

    // GET 파라미터 받기
    const params = new URLSearchParams(window.location.search);
    let inquiry_id = params.get('inquiry_id');

    (async () => {
        // 출력할 요소에 대한 변수 선언
        const type = document.querySelector(".type")
        const title = document.querySelector(".title_title")
        const inquiry_date = document.querySelector(".inquiry_date")
        const inquiry_text = document.querySelector(".inquiry_text")
        const answer_text = document.querySelector(".answer_text")
        const btn_group = document.querySelector(".btn_group")

        // 데이터를 저장할 전역변수 
        let json_inquiry = null;
        let json_login = null;
        try {
            const response1 = await axios.get('/inquiry/' + inquiry_id)
            const response2 = await axios.get('/members/info');
            json_inquiry = response1.data
            json_login = response2.data
        }catch (e) {
            alert(e.response.data.rtmsg);
            return;
        }
        console.log(json_inquiry);

        // 요소 출력
        if(json_inquiry != null) {

            // 작성자와 접속유저가 일치하는지 확인
            if (json_inquiry.item[0].user_id != json_login.item.user_id) {
                alert("접근 권한이 없습니다");
                history.back()
                throw new Error("접근 권한이 없습니다");
            }
            title.innerHTML = json_inquiry.item[0].title;
            type.innerHTML = json_inquiry.item[0].type
            inquiry_date.innerHTML = json_inquiry.item[0].inquiry_date
            inquiry_text.innerHTML = json_inquiry.item[0].inquiry_text
            answer_text.innerHTML = json_inquiry.item[0].answer_text
            
        }


        
        if(json_inquiry.item[0].state == "N") {
            btn_group.insertAdjacentHTML('afterbegin',
                `
                <button class="btn_modify" type="button"><a href="/GJ10_inquiry_modify_page/inquiry_modify.html?inquiry_id=${inquiry_id}">수정</a></button>
                `
            )  
        }
    })();
</script>
<script src="assets/js/cancel_btn.js"></script>
</body>
</html>