<!--
 @filename    : resevation_clear.html
 @author      : 한송희 (onee.ssong@gmail.com)
 @description : Grandjeju 예약 완료 페이지의 구조 구현
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrandJeju - 예약 완료</title>

    <link rel="stylesheet" href="../assets/css/all.css">
    <link rel="stylesheet" href="../assets/css/header_style.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/style_reservation_clear.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&family=Rubik&display=swap" rel="stylesheet">
</head>

<body>
    <div id="wrap">
        <!-- HEADER -->
        <div id="header">
            <h2 class="title">예약이 완료되었습니다.</h2>
        </div>
        <!-- CONTAINER -->
        <div id="container">
            <!-- CONTENT -->
            <div id="content">
                <div id="contents">

                </div>

                <!-- 예약 상세 내역 이동 버튼 -->
                <div class="btn_group">
                    <button class="btn_ok" type="button">확인</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script id="contents-template" type="text/x-handlebars-template">
        <!-- 객실 항목 -->
        <div class="room_group">
            <h3 class="roomtitle">객실</h3>
            <span class="select_room">{{room}}</span>
        </div>
        <!-- 숙박 기간 항목 -->
        <div class="date_group">
            <h3 class="datetitle">숙박 기간</h3>
            <span class="select_date">{{stay_start}} ~ {{stay_end}}</span>
        </div>
        <!-- 인원 항목 -->
        <div class="person_group">
            <h3 class="persontitle">인원</h3>
            <span class="select_person">{{person}}</span>
        </div>
        <!-- 예약자명 항목 -->
        <div class="name_group">
            <h3 class="nametitle">예약자명</h3>
            <span class="select_name">{{reserv_name}}</span>
        </div>
        <!-- 예약자 연락처 항목 -->
        <div class="number_group">
            <h3 class="numbertitle">예약자 연락처</h3>
            <span class="select_number">{{reserv_phone}}</span>
        </div>
        <!-- 결제 금액 항목 -->
        <div class="pay_group">
            <h3 class="paytitle">결제 금액</h3>
            <span class="select_pay">{{pay_price}}</span>
        </div>
    </script>

    <script>
        (async () => {
            let json = null;

            try {
                const response = await axios.get('/members/info');
                json = response.data;
            } catch (e) {
                alert(e.response.data.rtmsg);
                window.location = "/GJ2_login_page/login.html";
                return;
            }

            if (json != null) {
                (async () => {
                    /** GET 파라미터 받기 */
                    const params = new URLSearchParams(window.location.search);
                    const reserv_id = params.get('reserv_id');

                    if (!reserv_id) {
                        alert('해당 예약 내역이 없습니다.');
                        history.back();
                        return;
                    }

                    /** Ajax 요청 */
                    let json2 = null;

                    try {
                        const response = await axios.get('/reservation/' + reserv_id);
                        json2 = response.data;
                    } catch (e) {
                        alert(e.response.data.rtmsg);
                        return;
                    }

                    if (json2 != null) {
                        console.log(json2);
                        const source = document.querySelector("#contents-template").innerHTML;
                        const template = Handlebars.compile(source);
                        const html = template(json2.item[0]);

                        document.querySelector('#contents').insertAdjacentHTML('beforeend', html);

                        // 해당 예약 상세 내역 페이지 이동
                        document.querySelector('.btn_ok').addEventListener('click', e => {
                            location.href="/GJ7_reservation_detail_page/reservation_detail.html?reserv_id=" + json2.item[0].reserv_id;
                        });
                    }
                })();
            };
        })();
    </script>
</body>
</html>